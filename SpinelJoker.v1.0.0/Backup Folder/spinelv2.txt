--- STEAMODDED HEADER
--- MOD_NAME: Spinel Joker Mod
--- MOD_ID: j_spinel
--- MOD_AUTHOR: [FirstTry]
--- MOD_DESCRIPTION: I love Spinel.
--- PREFIX: spinel

SMODS.Atlas {
    key  = "spinel",
    path = "j_spinel.png",
    px   = 71,
    py   = 95,
}

SMODS.Joker {
    key = "spinel",
    atlas = "spinel",
    rarity = 3,
    cost = 6,
    unlocked = true,
    blueprint_compat = true,
    eternal_compat = true,
    pos = { x = 0, y = 0 },
    config = {
        extra = {
            Xmult = 6
        }
    },

    loc_txt = {
        name = "Spinel",
        text = {
            "{X:red,C:white}X#1#{} Mult",
            "{C:inactive}(Gains {X:red,C:white}X#2#{} if 4 Aces scored)"
        }
    },

    loc_vars = function(self, info_queue, center)
        return {
            vars = {
                center.ability.extra.Xmult,
                center.ability.extra.Xmult + 6
            }
        }
    end,

    calculate = function(self, card, context)
        if not card.ability.extra or not card.ability.extra.Xmult then
            card.ability.extra = card.ability.extra or {}
            card.ability.extra.Xmult = self.config.extra.Xmult or 6
        end

        if context.scoring_hand then
            local aces = 0
            for _, played_card in ipairs(context.scoring_hand) do
                if played_card:get_id() == 14 then
                    aces = aces + 1
                end
            end

            local current_xmult = card.ability.extra.Xmult
            local bonus = (aces == 4) and 6 or 0
            local total_xmult = current_xmult + bonus

            return {
                card = card,
                Xmult_mod = total_xmult,
                message = "X" .. tostring(total_xmult),
                colour = G.C.MULT,
                card_effects = { { H_X_mult = true } }
            }
        end
    end
}
